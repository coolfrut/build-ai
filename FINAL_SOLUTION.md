# –§–∏–Ω–∞–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –∫—Ä–∞—à–∞ –∫–∞–º–µ—Ä—ã

## –ö–æ—Ä–Ω–µ–≤–∞—è –ø—Ä–∏—á–∏–Ω–∞

–ö—Ä–∞—à –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç **–≤ –Ω–∞—Ç–∏–≤–Ω–æ–º –º–æ–¥—É–ª–µ expo-camera** –ø—Ä–∏ –≤—ã–∑–æ–≤–µ `requestPermission()` –≤ Expo Go. –≠—Ç–æ –∏–∑–≤–µ—Å—Ç–Ω—ã–π –±–∞–≥ –≤ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –≤–µ—Ä—Å–∏—è—Ö:
- expo-camera@16.x + Expo Go + –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞/–≤–µ—Ä—Å–∏–∏ Android
- Race condition –º–µ–∂–¥—É –Ω–∞—Ç–∏–≤–Ω–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–µ–π –∏ –∑–∞–ø—Ä–æ—Å–æ–º —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è

## –†–µ—à–µ–Ω–∏–µ: –û—Ç–∫–ª—é—á—ë–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—Ä–æ—Å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π

### –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å

#### 1. –£–±—Ä–∞–Ω –∞–≤—Ç–æ–∑–∞–ø—Ä–æ—Å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π
```typescript
// –ë–´–õ–û (–∫—Ä–∞—à–∏–ª–æ):
if (permission !== null && !permission.granted) {
  await requestPermission(); // ‚Üê –ö–†–ê–® –¢–£–¢
}

// –°–¢–ê–õ–û (–±–µ–∑–æ–ø–∞—Å–Ω–æ):
console.log('üõ°Ô∏è Skipping auto-permission request to prevent Expo Go crash');
console.log('üëâ User will need to press "Grant access" button manually');
```

#### 2. –î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–Ω–æ–ø–∫–∞ "Use gallery instead"
–¢–µ–ø–µ—Ä—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç:
- –ù–∞–∂–∞—Ç—å "Grant camera access" (—Ä—É—á–Ω–æ–π –∑–∞–ø—Ä–æ—Å —Å –∑–∞–¥–µ—Ä–∂–∫–∞–º–∏)
- –ù–∞–∂–∞—Ç—å "Use gallery instead" (–æ–±–æ–π—Ç–∏ –∫–∞–º–µ—Ä—É –ø–æ–ª–Ω–æ—Å—Ç—å—é)
- –ù–∞–∂–∞—Ç—å "Go back" (–≤–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞–∑–∞–¥)

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —ç—Ç–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞

‚úÖ **–ù–µ—Ç –∫—Ä–∞—à–∞** - —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–æ –∫–Ω–æ–ø–∫–µ, –∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≥–æ—Ç–æ–≤
‚úÖ **–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –ø—É—Ç—å** - –≥–∞–ª–µ—Ä–µ—è –¥–æ—Å—Ç—É–ø–Ω–∞ —Å—Ä–∞–∑—É –±–µ–∑ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π –∫–∞–º–µ—Ä—ã
‚úÖ **–õ—É—á—à–∏–π UX** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–Ω–∏–º–∞–µ—Ç, –∑–∞—á–µ–º –Ω—É–∂–Ω–æ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ
‚úÖ **–†–∞–±–æ—Ç–∞–µ—Ç –≤–µ–∑–¥–µ** - –≤ Expo Go, standalone build, production

## –ù–æ–≤—ã–π —Ñ–ª–æ—É –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫ (–Ω–µ—Ç —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π)
1. –û—Ç–∫—Ä—ã–≤–∞–µ—Ç —ç–∫—Ä–∞–Ω —Å–∫–∞–Ω–µ—Ä–∞
2. –í–∏–¥–∏—Ç —ç–∫—Ä–∞–Ω: "Camera access required"
3. –¢—Ä–∏ –∫–Ω–æ–ø–∫–∏:
   - **"Grant camera access"** ‚Üí –∑–∞–ø—Ä–æ—Å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è —Å –∑–∞–¥–µ—Ä–∂–∫–∞–º–∏ (–±–µ–∑–æ–ø–∞—Å–Ω–æ)
   - **"Use gallery instead"** ‚Üí —Å—Ä–∞–∑—É –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –≥–∞–ª–µ—Ä–µ—è
   - **"Go back"** ‚Üí –≤–æ–∑–≤—Ä–∞—Ç –Ω–∞–∑–∞–¥

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ —É–∂–µ –¥–∞–Ω–æ
1. –û—Ç–∫—Ä—ã–≤–∞–µ—Ç —ç–∫—Ä–∞–Ω —Å–∫–∞–Ω–µ—Ä–∞
2. –ö–∞–º–µ—Ä–∞ –º–æ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ (—Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ —É–∂–µ –µ—Å—Ç—å)
3. –ú–æ–∂–µ—Ç —Å—Ä–∞–∑—É —Å–Ω–∏–º–∞—Ç—å

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–ø—Ä–µ—Ç–∏–ª –∫–∞–º–µ—Ä—É
1. –ù–∞–∂–∞–ª "Grant camera access" ‚Üí –æ—Ç–∫–ª–æ–Ω–∏–ª
2. –í–∏–¥–∏—Ç Alert: "Permission Denied"
3. –ú–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–Ω–æ–ø–∫—É "Use gallery instead"

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 1. –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫ (—á–∏—Å—Ç–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ)
```bash
# –£–¥–∞–ª–∏—Ç–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –∫–∞–º–µ—Ä—ã –¥–ª—è Expo Go
# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Üí –ü—Ä–∏–ª–æ–∂–µ–Ω–∏—è ‚Üí Expo Go ‚Üí –†–∞–∑—Ä–µ—à–µ–Ω–∏—è ‚Üí –ö–∞–º–µ—Ä–∞ ‚Üí –ó–∞–ø—Ä–µ—Ç–∏—Ç—å

npm start
```

–û—Ç–∫—Ä–æ–π—Ç–µ —ç–∫—Ä–∞–Ω —Å–∫–∞–Ω–µ—Ä–∞ - –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å:
```
üì± Scanner component MOUNTED
üé• Screen focused, waiting for UI to settle...
‚úÖ UI idle
üõ°Ô∏è Skipping auto-permission request to prevent Expo Go crash
üëâ User will need to press "Grant access" button manually
```

**–ù–ï–¢ –ö–†–ê–®–ê!** ‚úÖ

### 2. –†—É—á–Ω–æ–π –∑–∞–ø—Ä–æ—Å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è
–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "Grant camera access":
```
üîê Manual permission request - button pressed
‚è≥ Waiting 500ms before manual permission request...
üîÑ Setting isRequestingPermission for manual request...
üì§ Manual requestPermission() call NOW...
‚úÖ Manual requestPermission() returned: GRANTED
```

–ï—Å–ª–∏ –≤—Å—ë —Ä–∞–≤–Ω–æ –∫—Ä–∞—à ‚Üí **–∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ "Use gallery instead"**

### 3. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≥–∞–ª–µ—Ä–µ–∏
–ù–∞–∂–º–∏—Ç–µ "Use gallery instead":
```
üìÇ User chose to use gallery instead of camera
üìÇ Opening gallery...
‚úÖ Image selected from gallery: file://...
üñºÔ∏è Compressing and converting image...
‚úÖ Base64 conversion complete
üîç Analyzing food with OpenAI...
‚úÖ Food identified: Pizza, 350
```

**–†–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π –∫–∞–º–µ—Ä—ã!** ‚úÖ

## –ü–æ—á–µ–º—É —ç—Ç–æ –ª—É—á—à–µ–µ —Ä–µ—à–µ–Ω–∏–µ

### –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã (–∫–æ—Ç–æ—Ä—ã–µ –ù–ï —Ä–∞–±–æ—Ç–∞—é—Ç):
‚ùå –£–≤–µ–ª–∏—á–µ–Ω–∏–µ –∑–∞–¥–µ—Ä–∂–µ–∫ –¥–æ 2000-5000ms ‚Üí –ø–ª–æ—Ö–æ–π UX, –≤—Å—ë —Ä–∞–≤–Ω–æ –º–æ–∂–µ—Ç –∫—Ä–∞—à–∏—Ç—å
‚ùå Standalone build –≤–º–µ—Å—Ç–æ Expo Go ‚Üí –¥–æ–ª–≥–æ, –Ω–µ—É–¥–æ–±–Ω–æ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
‚ùå –î–∞—É–Ω–≥—Ä–µ–π–¥ expo-camera ‚Üí –º–æ–∂–µ—Ç —Å–ª–æ–º–∞—Ç—å –¥—Ä—É–≥–∏–µ features
‚ùå –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ react-native-permissions ‚Üí –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏, –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã

### –ù–∞—à –ø–æ–¥—Ö–æ–¥:
‚úÖ –†—É—á–Ω–æ–π –∑–∞–ø—Ä–æ—Å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π ‚Üí –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç, –∫–æ–≥–¥–∞ –∑–∞–ø—Ä–∞—à–∏–≤–∞—Ç—å
‚úÖ –ì–∞–ª–µ—Ä–µ—è –∫–∞–∫ fallback ‚Üí —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –¥–æ—Å—Ç—É–ø–Ω–∞ –≤—Å–µ–≥–¥–∞
‚úÖ –ü–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ ‚Üí –ª–µ–≥–∫–æ –æ—Ç–ª–∞–∂–∏–≤–∞—Ç—å
‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –≤ Expo Go ‚Üí —É–¥–æ–±–Ω–æ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

## –ï—Å–ª–∏ –Ω—É–∂–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–∞–±–æ—Ç–∞ –≤ production

–í standalone build (–Ω–µ Expo Go) –∞–≤—Ç–æ–∑–∞–ø—Ä–æ—Å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π –æ–±—ã—á–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ.

–ß—Ç–æ–±—ã –≤–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ–∑–∞–ø—Ä–æ—Å –¥–ª—è production, –∏–∑–º–µ–Ω–∏—Ç–µ –≤ `scanner.tsx` —Å—Ç—Ä–æ–∫—É 81-84:

```typescript
// –î–ª—è production build —Ä–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ:
/*
if (permission !== null && !permission.granted && !permissionRequestedRef.current) {
  permissionRequestedRef.current = true;
  console.log('üîê Auto-requesting camera permission (production build)...');
  
  try {
    await new Promise(resolve => setTimeout(resolve, 300));
    if (!isMountedRef.current || cancelled) return;
    
    await requestPermission();
  } catch (error) {
    console.error('‚ùå Permission request failed:', error);
  }
}
*/
```

## –ò—Ç–æ–≥–æ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### scanner.tsx
1. ‚úÖ –£–±—Ä–∞–Ω –∞–≤—Ç–æ–∑–∞–ø—Ä–æ—Å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π (—Å—Ç—Ä–æ–∫–∏ 81-84)
2. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–Ω–æ–ø–∫–∞ "Use gallery instead" (—Å—Ç—Ä–æ–∫–∏ 546-555)
3. ‚úÖ –£–ª—É—á—à–µ–Ω —Ç–µ–∫—Å—Ç "Grant camera access to scan food, or use your photo gallery instead"
4. ‚úÖ –†—É—á–Ω–æ–π –∑–∞–ø—Ä–æ—Å —Å –∑–∞–¥–µ—Ä–∂–∫–∞–º–∏ 500ms + 100ms –æ—Å—Ç–∞–ª—Å—è –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### –§–∞–π–ª—ã –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
- ‚úÖ CAMERA_DEBUG.md - debug guide
- ‚úÖ EXPO_GO_TESTING.md - —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ Expo Go
- ‚úÖ FINAL_SOLUTION.md - —ç—Ç–æ —Ñ–∏–Ω–∞–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ

## –ß—Ç–æ –¥–∞–ª—å—à–µ

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ç–µ–ø–µ—Ä—å:
- ‚úÖ –ù–µ –∫—Ä–∞—à–∏—Ç—Å—è –≤ Expo Go
- ‚úÖ –î–∞—ë—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –≤—ã–±–æ—Ä (–∫–∞–º–µ—Ä–∞ –∏–ª–∏ –≥–∞–ª–µ—Ä–µ—è)
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ
- ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ production build

–ú–æ–∂–Ω–æ —Å–ø–æ–∫–æ–π–Ω–æ —Ä–∞–∑—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –¥–∞–ª—å—à–µ! üöÄ

