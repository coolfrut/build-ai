# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞–º–µ—Ä—ã –≤ Expo Go

## –ü—Ä–æ–±–ª–µ–º–∞, –∫–æ—Ç–æ—Ä—É—é –º—ã —Ä–µ—à–∏–ª–∏

–í –ª–æ–≥–∞—Ö –±—ã–ª–æ –≤–∏–¥–Ω–æ **–¥–≤–æ–π–Ω–æ–π –≤—ã–∑–æ–≤ useEffect**:
```
LOG  üé• Screen focused, waiting for UI to settle...
LOG  ‚úÖ UI idle
LOG  üé• Screen focused, waiting for UI to settle...  <- –î–£–ë–õ–ò–ö–ê–¢!
LOG  ‚úÖ UI idle                                      <- –î–£–ë–õ–ò–ö–ê–¢!
```

–≠—Ç–æ –≤—ã–∑—ã–≤–∞–ª–æ:
1. **–î–≤–æ–π–Ω–æ–π –∑–∞–ø—Ä–æ—Å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è** ‚Üí –∫—Ä–∞—à –Ω–∞—Ç–∏–≤–Ω–æ–≥–æ –º–æ–¥—É–ª—è
2. **–ó–∞—Ü–∏–∫–ª–∏–≤–∞–Ω–∏–µ useEffect** –∏–∑-–∑–∞ `isRequestingPermission` –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è—Ö

## –ß—Ç–æ –∏—Å–ø—Ä–∞–≤–∏–ª–∏

### 1. –î–æ–±–∞–≤–ª–µ–Ω `permissionRequestedRef`
```typescript
const permissionRequestedRef = useRef(false);
```
–ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π —á–µ—Ä–µ–∑ ref (–Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç —Ä–µ-—Ä–µ–Ω–¥–µ—Ä—ã).

### 2. –£–±—Ä–∞–Ω–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç `isRequestingPermission` –≤ useEffect
```typescript
// –ë–´–õ–û (–ø–ª–æ—Ö–æ):
}, [isFocused, permission, isRequestingPermission]); // <- –≤—ã–∑—ã–≤–∞–µ—Ç loop

// –°–¢–ê–õ–û (—Ö–æ—Ä–æ—à–æ):
}, [isFocused, permission?.granted]); // <- —Ç–æ–ª—å–∫–æ –≤–Ω–µ—à–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
```

### 3. –î–æ–±–∞–≤–ª–µ–Ω —Ñ–ª–∞–≥ `cancelled` –≤ cleanup
```typescript
let cancelled = false;

return () => {
  cancelled = true; // –û—Ç–º–µ–Ω—è–µ—Ç –≤—Å–µ async –æ–ø–µ—Ä–∞—Ü–∏–∏
  if (interactionHandle?.cancel) {
    interactionHandle.cancel();
  }
};
```

### 4. –£–≤–µ–ª–∏—á–µ–Ω–∞ –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–æ 300ms –¥–ª—è Expo Go
```typescript
await new Promise(resolve => setTimeout(resolve, 300));
```
Expo Go —Ç—Ä–µ–±—É–µ—Ç –±–æ–ª—å—à–µ –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ —Å—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏—é UI.

### 5. –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
```typescript
console.log('üì§ Calling requestPermission()...');
await requestPermission();
console.log('‚úÖ requestPermission() completed');
```

## –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ª–æ–≥–æ–≤

–¢–µ–ø–µ—Ä—å –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å **–ë–ï–ó –î–£–ë–õ–ò–ö–ê–¢–û–í**:

```
üì± Scanner component MOUNTED
üé• Screen focused, waiting for UI to settle...
‚úÖ UI idle
üîê Auto-requesting camera permission after UI settled...
üì§ Calling requestPermission()...
‚úÖ requestPermission() completed
‚úÖ‚úÖ‚úÖ Camera onCameraReady callback FIRED! ‚úÖ‚úÖ‚úÖ
```

## –ö–∞–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ Expo Go

### 1. –ß–∏—Å—Ç–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞
```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä
Ctrl+C

# –û—á–∏—Å—Ç–∏—Ç–µ –∫—ç—à
npm start -- --clear

# –í Expo Go: —É–¥–∞–ª–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏–∑ —Å–ø–∏—Å–∫–∞ –∏ –∑–∞–Ω–æ–≤–æ –æ—Ç—Å–∫–∞–Ω–∏—Ä—É–π—Ç–µ QR
```

### 2. –£–¥–∞–ª–∏—Ç–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –∫–∞–º–µ—Ä—ã
- Android: –ù–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Üí –ü—Ä–∏–ª–æ–∂–µ–Ω–∏—è ‚Üí Expo Go ‚Üí –†–∞–∑—Ä–µ—à–µ–Ω–∏—è ‚Üí –ö–∞–º–µ—Ä–∞ ‚Üí –ó–∞–ø—Ä–µ—Ç–∏—Ç—å
- iOS: –ù–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Üí Expo Go ‚Üí –ö–∞–º–µ—Ä–∞ ‚Üí –ó–∞–ø—Ä–µ—Ç–∏—Ç—å

### 3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
```bash
npm start
```

### 4. –û—Ç–∫—Ä–æ–π—Ç–µ —ç–∫—Ä–∞–Ω —Å–∫–∞–Ω–µ—Ä–∞
**–í–ê–ñ–ù–û**: –ø–æ–¥–æ–∂–¥–∏—Ç–µ 2-3 —Å–µ–∫—É–Ω–¥—ã –ø–æ—Å–ª–µ –æ—Ç–∫—Ä—ã—Ç–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –ø—Ä–µ–∂–¥–µ —á–µ–º –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç—å –Ω–∞ —Å–∫–∞–Ω–µ—Ä.

### 5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏
–í—ã –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å **–æ–¥–∏–Ω–∞—Ä–Ω—ã–µ** –≤—ã–∑–æ–≤—ã (–Ω–µ –¥–≤–æ–π–Ω—ã–µ).

## –ï—Å–ª–∏ –≤—Å—ë –µ—â—ë –≤–∏–¥–∏—Ç–µ –¥–≤–æ–π–Ω—ã–µ –≤—ã–∑–æ–≤—ã

### React 18 Strict Mode
–í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ React –º–æ–∂–µ—Ç –º–æ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –¥–≤–∞–∂–¥—ã. –≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ, –µ—Å–ª–∏:
- –ö–∞–∂–¥–∞—è –≥—Ä—É–ø–ø–∞ –ª–æ–≥–æ–≤ **–∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è –±–µ–∑ –∫—Ä–∞—à–∞**
- –ú–µ–∂–¥—É –≥—Ä—É–ø–ø–∞–º–∏ –µ—Å—Ç—å "UNMOUNTED"

–ü—Ä–∏–º–µ—Ä –Ω–æ—Ä–º–∞–ª—å–Ω–æ–≥–æ Strict Mode:
```
üì± Scanner component MOUNTED
üé• Screen focused...
‚úÖ UI idle
üì± Scanner component UNMOUNTED      <- cleanup
üì± Scanner component MOUNTED        <- remount (strict mode)
üé• Screen focused...
‚úÖ UI idle
üì§ Calling requestPermission()...   <- –≤—ã–∑–æ–≤ –û–î–ò–ù –†–ê–ó (–±–ª–∞–≥–æ–¥–∞—Ä—è ref)
‚úÖ requestPermission() completed
```

### –ï—Å–ª–∏ –∫—Ä–∞—à –º–µ–∂–¥—É –ª–æ–≥–∞–º–∏

–ù–∞–π–¥–∏—Ç–µ —Ç–æ—á–Ω–æ–µ –º–µ—Å—Ç–æ –∫—Ä–∞—à–∞:
```
üì§ Calling requestPermission()...
[CRASH HERE - app closes]
```

–≠—Ç–æ –∑–Ω–∞—á–∏—Ç –∫—Ä–∞—à –≤ **–Ω–∞—Ç–∏–≤–Ω–æ–º –º–æ–¥—É–ª–µ Expo Camera** –¥–æ –≤–æ–∑–≤—Ä–∞—Ç–∞ –∏–∑ `requestPermission()`.

**–†–µ—à–µ–Ω–∏–µ**: –£–≤–µ–ª–∏—á—å—Ç–µ –∑–∞–¥–µ—Ä–∂–∫—É –¥–æ 500ms –∏–ª–∏ 1000ms:
```typescript
// –í scanner.tsx, —Å—Ç—Ä–æ–∫–∞ ~89
await new Promise(resolve => setTimeout(resolve, 500)); // –±—ã–ª–æ 300
```

## –°–ø–µ—Ü–∏—Ñ–∏–∫–∞ Expo Go

### 1. Expo Go != Production build
Expo Go –∏–º–µ–µ—Ç:
- –ë–æ–ª—å—à–µ overhead –Ω–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é –º–æ–¥—É–ª–µ–π
- Shared native modules –º–µ–∂–¥—É –ø—Ä–æ–µ–∫—Ç–∞–º–∏
- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å–ª–æ–∏ –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è**: –¥–ª—è —Ñ–∏–Ω–∞–ª—å–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ–±–µ—Ä–∏—Ç–µ standalone build:
```bash
eas build --profile development --platform android
```

### 2. Hot Reload –º–æ–∂–µ—Ç –≤—ã–∑—ã–≤–∞—Ç—å –∫—Ä–∞—à–∏
–ï—Å–ª–∏ –º–µ–Ω—è–µ—Ç–µ –∫–æ–¥ –∫–∞–º–µ—Ä—ã - **–ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–π—Ç–µ**:
- –í Expo Go: –≤—Å—Ç—Ä—è—Ö–Ω–∏—Ç–µ —Ç–µ–ª–µ—Ñ–æ–Ω ‚Üí "Reload"
- –ò–ª–∏: `r` –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ Metro bundler

### 3. –ù–µ—Å–∫–æ–ª—å–∫–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π –≤ Expo Go
–ï—Å–ª–∏ –≤ Expo Go –æ—Ç–∫—Ä—ã—Ç–æ >1 –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Å –∫–∞–º–µ—Ä–æ–π - –º–æ–∂–µ—Ç –±—ã—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç.
**–†–µ—à–µ–Ω–∏–µ**: –∑–∞–∫—Ä–æ–π—Ç–µ –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç—ã –≤ Expo Go.

## Debug —á–µ–∫–ª–∏—Å—Ç –¥–ª—è Expo Go

- [ ] –°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω —Å `npm start` (–Ω–µ `npm run start-prod`)
- [ ] –ö—ç—à –æ—á–∏—â–µ–Ω (`npm start -- --clear`)
- [ ] –í Expo Go —Ç–æ–ª—å–∫–æ –æ–¥–Ω–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
- [ ] –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ –∫–∞–º–µ—Ä—ã —É–¥–∞–ª–µ–Ω–æ –ø–µ—Ä–µ–¥ —Ç–µ—Å—Ç–æ–º
- [ ] –ü–æ–¥–æ–∂–¥–∞–ª–∏ 2-3 —Å–µ–∫ –ø–æ—Å–ª–µ –æ—Ç–∫—Ä—ã—Ç–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- [ ] –í –ª–æ–≥–∞—Ö **–ù–ï–¢** –¥–≤–æ–π–Ω—ã—Ö "Screen focused" –ø–æ–¥—Ä—è–¥ –±–µ–∑ "UNMOUNTED"
- [ ] –õ–æ–≥–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç `üì§ Calling requestPermission()...`
- [ ] –ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –ª–æ–≥–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ù–ï –∫—Ä–∞—à–∏—Ç—Å—è

## –ï—Å–ª–∏ –°–ù–û–í–ê –∫—Ä–∞—à

–ü—Ä–∏—Å—ã–ª–∞–π—Ç–µ –ª–æ–≥–∏ –Ω–∞—á–∏–Ω–∞—è —Å:
```
üì± Scanner component MOUNTED
```
–¥–æ –º–æ–º–µ–Ω—Ç–∞ –∫—Ä–∞—à–∞ (–∏–ª–∏ –¥–æ –∫–æ–Ω—Ü–∞, –µ—Å–ª–∏ –∫—Ä–∞—à–∞ –Ω–µ—Ç).

–í–∞–∂–Ω—ã:
1. –ï—Å—Ç—å –ª–∏ "UNMOUNTED" –º–µ–∂–¥—É –¥—É–±–ª–∏–∫–∞—Ç–∞–º–∏
2. –î–æ—Ö–æ–¥–∏—Ç –ª–∏ –¥–æ `üì§ Calling requestPermission()`
3. –î–æ—Ö–æ–¥–∏—Ç –ª–∏ –¥–æ `‚úÖ requestPermission() completed`
4. –ù–∞ –∫–∞–∫–æ–º —ç—Ç–∞–ø–µ –∫—Ä–∞—à

